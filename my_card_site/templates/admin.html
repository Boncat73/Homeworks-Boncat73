<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Адмін-панель | Керування повідомленнями</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    
    <style>
    </style>
</head>
<body>
    <!--Jinja2 (мова шаблонів):тут показує користувачеві 
    "спливаючі" повідомлення,які передаються з app.py-->
    {% with messages = get_flashed_messages(with_categories=true) %} <!--Flask дістає усі повідомлення за допомогою flash()-->
        {% if messages %} <!--браузер перевіряє наявність повідомлень для показу-->
            {% for category, message in messages %} <!--цикл виводить по черзі кожне повідомлення,якщо вони є-->
                <div class="alert alert-{{ category }}"> <!--поєднання HTML та CSS: green for success,red for danger-->
                    <i class="fa-solid fa-bell"></i> {{ message }} <!--тут текст самого повідомлення-->
                </div>
            <!--закриваючі теги,які кажуть шаблонізатору,де закінчуються цикл та логічна перевірка-->
            {% endfor %}
        {% endif %}
    {% endwith %}

    <div class="admin-container">
        <a href="/" class="back-link"><i class="fa-solid fa-arrow-left"></i> На головну</a>
        <br> <a href="/logout" class="logout-link"><i class="fa-solid fa-right-from-bracket"></i> Вийти із системи</a>
        <h1><i class="fa-solid fa-gears"></i> Панель керування</h1>
        <p>Тут ви можете переглядати, редагувати або видаляти повідомлення користувачів.</p>

        <!--"Тут реалізовано динамічний вивід даних за допомогою шаблонізатора Jinja2. 
        Використовуємо цикл for для генерації рядків таблиці.Застосовуємо форматування 
        об'єктів datetime через метод strftime та реалізуємо безпечне видалення записів через 
        передачу унікального ID повідомлення в URL-адресу."-->
        <table class="admin-table">
            <thead>
                <tr>
                    <th>Дата</th>
                    <th>Відправник</th>
                    <th>Email</th>
                    <th>Повідомлення</th>
                    <th style="text-align:center;">Дії</th>
                </tr>
            </thead>
            <tbody>
                {% if messages %}
                    {% for msg in messages %}
                    <tr>
                        <td style="font-size: 0.9rem; color: #666;">
                            {{ msg.date_sent.strftime('%d.%m.%Y %H:%M') }}
                        </td>
                        <td><strong>{{ msg.name }}</strong></td>
                        <td><a href="mailto:{{ msg.email }}">{{ msg.email }}</a></td>
                        <td>{{ msg.text[:50] }}{% if msg.text|length > 50 %}...{% endif %}</td>
                        <td class="actions">
                            <a href="{{ url_for('edit_message', id=msg.id) }}" class="btn-edit" title="Редагувати">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </a>
                            
                            <a href="{{ url_for('delete_message', id=msg.id) }}" 
                                class="btn-delete" 
                                title="Видалити"
                                onclick="return confirm('Ви впевнені, що хочете видалити це повідомлення?')">
                                <i class="fa-solid fa-trash-can"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="5" style="text-align: center; padding: 30px; color: #999;">
                            Повідомлень поки немає.
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <script>
        setTimeout(() => {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(a => {
                a.style.transition = "opacity 0.5s ease";
                a.style.opacity = "0";
                setTimeout(() => a.remove(), 500);
            });
        }, 3000);
    </script>

</body>
</html>